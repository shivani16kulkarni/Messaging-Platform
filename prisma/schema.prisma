generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id              String         @id @default(cuid())
  email           String         @unique
  passwordHash    String?
  displayName     String
  isActive        Boolean        @default(true)
  emailVerifiedAt DateTime?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  googleId        String?
  messages        Message[]
  otps            Otp[]
  participants    Participant[]
  refreshTokens   RefreshToken[]
}

model Otp {
  id        String      @id @default(cuid())
  userId    String
  purpose   PurposeType @default(SIGNUP)
  otpHash   String
  expiresAt DateTime
  attempts  Int         @default(0)
  usedAt    DateTime?
  createdAt DateTime    @default(now())
  user      User        @relation(fields: [userId], references: [id])
}

model RefreshToken {
  id         String    @id @default(cuid())
  token      String    @unique
  userId     String
  createdAt  DateTime  @default(now())
  expiresAt  DateTime
  revokedAt  DateTime?
  replacedBy String?
  user       User      @relation(fields: [userId], references: [id])
}

model Conversation {
  id           String        @id @default(cuid())
  name         String?
  imageUrl     String?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  messages     Message[]
  participants Participant[]
}

model Message {
  id             String       @id @default(cuid())
  content        String
  createdAt      DateTime     @default(now())
  conversationId String
  userId         String
  type           MessageType  @default(TEXT)
  conversation   Conversation @relation(fields: [conversationId], references: [id])
  user           User         @relation(fields: [userId], references: [id])
}

model Participant {
  id             String       @id @default(cuid())
  userId         String
  conversationId String
  role           String?
  joinedAt       DateTime     @default(now())
  leftAt         DateTime?
  conversation   Conversation @relation(fields: [conversationId], references: [id])
  user           User         @relation(fields: [userId], references: [id])

  @@unique([conversationId, userId])
}

enum MessageType {
  TEXT
  IMAGE
  FILE
}

enum PurposeType {
  SIGNUP
  RESET_PASSWORD
}
